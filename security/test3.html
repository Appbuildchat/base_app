<!DOCTYPE html>
<html>
<head>
  <title>Firebase Security Test</title>
</head>
<body>
  <h1>Testing Firebase Public Access</h1>
  <p>Check the browser's developer console (press F12) to see the result.</p>

  <script type="module">
    // 1. Import the necessary functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 2. PASTE YOUR WEB CONFIGURATION HERE
    const firebaseConfig = {
      apiKey: 'AIzaSyB6xZ14ClFl4LhHtI6PAU_nsV0ZRLTw-8o',
      appId: '1:1093996912048:web:882a8e0ace1869f6484a75',
      messagingSenderId: '1093996912048',
      projectId: 'red-alix-albi--abc',
      authDomain: 'red-alix-albi--abc.firebaseapp.com',
      storageBucket: 'red-alix-albi--abc.firebasestorage.app',
    };

    // 3. Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // This function tries to WRITE data
    async function testPublicWrite() {
      try {
        const testDocRef = doc(db, "securityTest", "isThisPublic");
        await setDoc(testDocRef, {
          message: "This write was successful from a public script.",
          timestamp: new Date()
        });
        console.log("✅ WRITE SUCCESS: Your write rules are public!");
      } catch (error) {
        console.error("❌ WRITE FAILED:", error.message);
      }
    }

    // --- NEW FUNCTION TO READ/LIST DATA ---
    async function testPublicRead() {
      try {
        const querySnapshot = await getDocs(collection(db, "securityTest"));
        console.log("✅ READ SUCCESS: Your read rules are public! Found documents:");
        querySnapshot.forEach((doc) => {
          // .data() contains the document's fields
          console.log(`${doc.id} =>`, doc.data());
        });
      } catch (error) {
        console.error("❌ READ FAILED:", error.message);
      }
    }

    // Run both tests
    await testPublicWrite();
    await testPublicRead();
  </script>
</body>
</html>